<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>DocTable Schemas - My Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../documentation/ex_basics/" class="dropdown-item">Basics of doctable</a>
</li>
                                    
<li>
    <a href="../../documentation/ex_insert_delete/" class="dropdown-item">Insert and Delete Queries with doctable</a>
</li>
                                    
<li>
    <a href="../../documentation/ex_schemas/" class="dropdown-item">Table Schemas</a>
</li>
                                    
<li>
    <a href="../../documentation/ex_select/" class="dropdown-item">Select Queries with doctable</a>
</li>
                                    
<li>
    <a href="../../documentation/iris_example/" class="dropdown-item">Iris example</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Legacy documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../dataclass_example/" class="dropdown-item">Dataclass Schema Example</a>
</li>
                                    
<li>
    <a href="../dataclass_vignette_advanced/" class="dropdown-item">Advanced dataclass schema vignette</a>
</li>
                                    
<li>
    <a href="../depric_vignette_newsgroups/" class="dropdown-item">NewsGroups Dataset Vignette</a>
</li>
                                    
<li>
    <a href="../distributed_basics/" class="dropdown-item">Distribute Parallel Processing Basics</a>
</li>
                                    
<li>
    <a href="../doctable_basics/" class="dropdown-item">DocTable Overview</a>
</li>
                                    
<li>
    <a href="../doctable_bootstrap/" class="dropdown-item">Document Bootstrapping Examples</a>
</li>
                                    
<li>
    <a href="../doctable_concurrency/" class="dropdown-item">Concurrent Database Connections</a>
</li>
                                    
<li>
    <a href="../doctable_connectengine/" class="dropdown-item">Manage SQL Connections with DocTable</a>
</li>
                                    
<li>
    <a href="../doctable_file_column_types/" class="dropdown-item">DocTable File Column Types</a>
</li>
                                    
<li>
    <a href="../doctable_insert_delete/" class="dropdown-item">DocTable Examples: Insert and Delete</a>
</li>
                                    
<li>
    <a href="../doctable_multitable/" class="dropdown-item">Example: Multiple Tables</a>
</li>
                                    
<li>
    <a href="../doctable_parsetreedoc_column/" class="dropdown-item">ParseTreeDoc Column Types</a>
</li>
                                    
<li>
    <a href="../doctable_picklefile/" class="dropdown-item">DocTable Example: Pickle and Text Files</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">DocTable Schemas</a>
</li>
                                    
<li>
    <a href="../doctable_schema_dataclass/" class="dropdown-item">DocTable Example: Schemas</a>
</li>
                                    
<li>
    <a href="../doctable_schema_legacy/" class="dropdown-item">DocTable Schemas</a>
</li>
                                    
<li>
    <a href="../doctable_select/" class="dropdown-item">DocTable Examples: Select</a>
</li>
                                    
<li>
    <a href="../doctable_update/" class="dropdown-item">DocTable Examples: Update</a>
</li>
                                    
<li>
    <a href="../example_nss_1_intro/" class="dropdown-item">Vignette 1: Storing Document Metadata</a>
</li>
                                    
<li>
    <a href="../example_nss_2_parsing/" class="dropdown-item">Vignette 2: Storing Document Text</a>
</li>
                                    
<li>
    <a href="../example_nss_3_parsetrees/" class="dropdown-item">Vignette 3: Storing Parsed Documents</a>
</li>
                                    
<li>
    <a href="../example_nss_intro_dataclass/" class="dropdown-item">Example 1: US National Security Strategy Document Corpus</a>
</li>
                                    
<li>
    <a href="../legacy_adv/" class="dropdown-item">DocTable (slightly more) Advanced Example</a>
</li>
                                    
<li>
    <a href="../legacy_simple/" class="dropdown-item">DocTable Simple Example</a>
</li>
                                    
<li>
    <a href="../parse_parsepipeline/" class="dropdown-item">ParsePipeline Basics</a>
</li>
                                    
<li>
    <a href="../parse_parsetrees/" class="dropdown-item">Working with doctable Parsetrees</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../doctable_picklefile/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../doctable_schema_dataclass/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#doctable-schemas" class="nav-link">DocTable Schemas</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#introduction" class="nav-link">Introduction</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#the-doctableschema-decorator" class="nav-link">The doctable.schema Decorator</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#use-doctablecol-for-more-control-over-schema-creation" class="nav-link">Use doctable.Col For More Control Over Schema Creation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#working-with-schema-objects" class="nav-link">Working With Schema Objects</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#indices-and-constraints" class="nav-link">Indices and Constraints</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#conclusions" class="nav-link">Conclusions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="doctable-schemas">DocTable Schemas</h1>
<p>Your database table column names and types come from a schema class defined using the <code>@doctable.schema</code> decorator. In addition to providing a schema definition, this class can be used to encapsulate data when inserting or retrieving from the database. </p>
<p>At its most basic, your schema class operates like a <a href="https://realpython.com/python-data-classes/">dataclass</a> that uses slots for efficiency and allows for custom methods that will not affect the database schema.</p>
<pre><code class="language-python">from datetime import datetime
from pprint import pprint
import pandas as pd

import sys
sys.path.append('..')
import doctable
</code></pre>
<h1 id="introduction">Introduction</h1>
<p>This is an example of a basic doctable schema. Note the use of the decorator <code>@doctable.schema</code>, the inclusion of <code>__slots__ = []</code>, and the type hints of the member variables - I will explain each of these later in this document.</p>
<p>This class represents a database schema that includes two columns: <code>name</code> (an <code>int</code>) and <code>age</code> (a <code>str</code>).</p>
<pre><code class="language-python">@doctable.schema
class Record:
    __slots__ = []
    name: str
    age: int
</code></pre>
<p>The schema class definition is then provided to the doctable constructor to create the database table. Here we create an in-memory sqlite table and show the schema resulting from our custom class. Note that doctable automatically inferred that <code>name</code> should be a <code>VARCHAR</code> and <code>age</code> should be an <code>INTEGER</code> based on the provided type hints.</p>
<pre><code class="language-python"># the schema that would result from this dataclass:
table = doctable.DocTable(target=':memory:', schema=Record)
table.schema_table()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>type</th>
      <th>nullable</th>
      <th>default</th>
      <th>autoincrement</th>
      <th>primary_key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>name</td>
      <td>VARCHAR</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>age</td>
      <td>INTEGER</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can also use the schema class to insert data into our <code>DocTable</code>. We simply create a new <code>Record</code> and pass it to the <code>DocTable.insert()</code> method. Using <code>.head()</code>, we see the contents of the database so far. Note that you may also pass a dictionary to insert data - this is just one way of inserting data.</p>
<pre><code class="language-python">new_record = Record(name='Devin Cornell', age=30)
print(new_record)
table.insert(new_record)
table.head()
</code></pre>
<pre><code>Record(name='Devin Cornell', age=30)
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Devin Cornell</td>
      <td>30</td>
    </tr>
  </tbody>
</table>
</div>

<p>And perhaps more usefully, we can use it to encapsulate results from <code>.select()</code> queries. Note that the returned object is exactly the same as the one we put in. Slot classes are more memory-efficient than dictionaries for storing data, but there is cpu time overhead from inserting that data into the slots.</p>
<pre><code class="language-python">first_record = table.select_first()
print(first_record)
</code></pre>
<pre><code>Record(name='Devin Cornell', age=30)
</code></pre>
<p>But, of course, the data can be returned in its raw format by passing the parameter <code>as_dataclass=False</code>.</p>
<pre><code class="language-python">first_record = table.select_first(as_dataclass=False)
print(first_record)
</code></pre>
<pre><code>('Devin Cornell', 30)
</code></pre>
<h1 id="the-doctableschema-decorator">The <code>doctable.schema</code> Decorator</h1>
<p>The <code>@doctable.schema</code> decorator does the work to convert your custom class into a schema class. It transforms your schema class in three ways:</p>
<ol>
<li>
<p><strong>create slots</strong>: First, <a href="https://docs.python.org/3/reference/datamodel.html#slots">slot</a> variable names will be added to <code>__slots__</code> automatically based on the fields in your class definition. This is why the default functionality requires you to add <code>__slots__ = []</code> with no variable names. You may also turn slots off by passing <code>require_slots=False</code> to the decorator (i.e. <code>@doctable.schema(require_slots=False)</code>), otherwise an exception will be raised.</p>
</li>
<li>
<p><strong>convert to dataclass</strong>: Second, your schema class will be converted to a <a href="https://realpython.com/python-data-classes/">dataclass</a> that generates <code>__init__</code>, <code>__repr__</code>, and other boilerplate methods meant for classes that primarily store data. Any keyword arguments passed to the <code>schema</code> decorator, with the exception of <code>require_slots</code>, will be passed directly to the <code>@dataclasses.dataclass</code> decorator so you have control over the dataclass definition.</p>
</li>
<li>
<p><strong>inherit from <code>DocTableSchema</code></strong>: Lastly, your schema class will inherit from <code>doctable.DocTableSchema</code>, which provides additional accessors that are used for storage in a <code>DocTable</code> and fine-grained control over retreived data. More on this later.</p>
</li>
</ol>
<p>Column names and types will be inferred from the type hints in your schema class definition. Because <code>DocTable</code> is built on <a href="https://docs.sqlalchemy.org/en/14/core/">sqlalchemy core</a>, all fields will eventually be converted to <a href="https://docs.sqlalchemy.org/en/13/core/type_basics.html"><code>sqlalchemy</code> column objects</a> and added to the DocTable metadata. This table shows the type mappings implemented in doctable:</p>
<pre><code class="language-python">doctable.python_to_slqlchemy_type
</code></pre>
<pre><code>{int: sqlalchemy.sql.sqltypes.Integer,
 float: sqlalchemy.sql.sqltypes.Float,
 str: sqlalchemy.sql.sqltypes.String,
 bool: sqlalchemy.sql.sqltypes.Boolean,
 datetime.datetime: sqlalchemy.sql.sqltypes.DateTime,
 datetime.time: sqlalchemy.sql.sqltypes.Time,
 datetime.date: sqlalchemy.sql.sqltypes.Date,
 doctable.textmodels.parsetreedoc.ParseTreeDoc: doctable.schemas.custom_coltypes.ParseTreeDocFileType}
</code></pre>
<p>For example, see this example of the most basic possible schema class that can be used to create a doctable. We use static defaulted parameters and type hints including <code>str</code>, <code>int</code>, <code>datetime</code>, and <code>Any</code>, which you can see are converted to <code>VARCHAR</code>, <code>INTEGER</code>, <code>DATETIME</code>, and <code>BLOB</code> column types, respectively. <code>BLOB</code> was used because the provided type hint <code>Any</code> has no entry in the above table.</p>
<pre><code class="language-python">from typing import Any
import datetime

@doctable.schema
class Record:
    __slots__ = []
    name: str = None
    age: int = None
    time: datetime.datetime = None
    friends: Any = None

# the schema that would result from this dataclass:
doctable.DocTable(target=':memory:', schema=Record).schema_table()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>type</th>
      <th>nullable</th>
      <th>default</th>
      <th>autoincrement</th>
      <th>primary_key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>name</td>
      <td>VARCHAR</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>age</td>
      <td>INTEGER</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>time</td>
      <td>DATETIME</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>friends</td>
      <td>BLOB</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>You can see that this class operates much like a regular dataclass with slots. Thus, these defaulted parameters are applied in the constructor of the schema class, and <em>NOT</em> as the default value in the database schema.</p>
<pre><code class="language-python">Record('Devin Cornell', 30)
</code></pre>
<pre><code>Record(name='Devin Cornell', age=30, time=None, friends=None)
</code></pre>
<h1 id="use-doctablecol-for-more-control-over-schema-creation">Use <code>doctable.Col</code> For More Control Over Schema Creation</h1>
<p>Using <code>doctable.Col()</code> as a default value in the schema class definition can give you more control over schema definitions. </p>
<p>Firstly, this function returns a dataclass <a href="https://docs.python.org/3/library/dataclasses.html#dataclasses.field"><code>field</code></a> object that can be used to set parameters like <code>default_factory</code> or <code>compare</code> as used by the dataclass. Pass arguments meant for <code>field</code> through the <code>Col</code> parameter <code>field_kwargs=dict(..)</code>. Other data passed to <code>Col</code> will be used to create the <code>DocTable</code> schema, which is stored as metadata inside the <code>field</code>.</p>
<p>This example shows how <code>Col</code> can be used to set some parameters meant for <code>field</code>. These will affect your schema class behavior without affecting the produced DocTable schema.</p>
<pre><code class="language-python">@doctable.schema
class Record:
    __slots__ = []
    name: str = doctable.Col()
    age: int = doctable.Col(field_kwargs=dict(default_factory=list, compare=True))

Record()
</code></pre>
<pre><code>Record(age=[])
</code></pre>
<p><code>Col</code> also allows you to explicitly specify a column type using a string, sqlalchemy type definition, or sqlalchemy instance passed to <code>column_type</code>. You can then pass arguments meant for the sqlalchemy type constructor through <code>type_kwargs</code>. You may also use <code>type_kwargs</code> with the column type inferred from the type hint.</p>
<pre><code class="language-python">import sqlalchemy

@doctable.schema
class Record:
    __slots__ = []

    # providing only the type as first argument
    age: int = doctable.Col(sqlalchemy.BigInteger)

    # these are all quivalent
    name1: str = doctable.Col(type_kwargs=dict(length=100)) # infers type from type hint
    name2: str = doctable.Col(sqlalchemy.String, type_kwargs=dict(length=100)) # accepts provided type sqlalchemy.String, pass parameters through type_kwargs
    name3: str = doctable.Col(sqlalchemy.String(length=100)) # accepts type instance (no need for type_kwargs this way)
    name4: str = doctable.Col('string', type_kwargs=dict(length=100))


# the schema that would result from this dataclass:
doctable.DocTable(target=':memory:', schema=Record).schema_table()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>type</th>
      <th>nullable</th>
      <th>default</th>
      <th>autoincrement</th>
      <th>primary_key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>age</td>
      <td>BIGINT</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>name1</td>
      <td>VARCHAR(100)</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>name2</td>
      <td>VARCHAR(100)</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>name3</td>
      <td>VARCHAR(100)</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>name4</td>
      <td>VARCHAR(100)</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>A full list of string -&gt; sqlalchemy type mappings is shown below:</p>
<pre><code class="language-python">doctable.string_to_sqlalchemy_type
</code></pre>
<pre><code>{'biginteger': sqlalchemy.sql.sqltypes.BigInteger,
 'boolean': sqlalchemy.sql.sqltypes.Boolean,
 'date': sqlalchemy.sql.sqltypes.Date,
 'datetime': sqlalchemy.sql.sqltypes.DateTime,
 'enum': sqlalchemy.sql.sqltypes.Enum,
 'float': sqlalchemy.sql.sqltypes.Float,
 'integer': sqlalchemy.sql.sqltypes.Integer,
 'interval': sqlalchemy.sql.sqltypes.Interval,
 'largebinary': sqlalchemy.sql.sqltypes.LargeBinary,
 'numeric': sqlalchemy.sql.sqltypes.Numeric,
 'smallinteger': sqlalchemy.sql.sqltypes.SmallInteger,
 'string': sqlalchemy.sql.sqltypes.String,
 'text': sqlalchemy.sql.sqltypes.Text,
 'time': sqlalchemy.sql.sqltypes.Time,
 'unicode': sqlalchemy.sql.sqltypes.Unicode,
 'unicodetext': sqlalchemy.sql.sqltypes.UnicodeText,
 'json': doctable.schemas.custom_coltypes.JSONType,
 'pickle': doctable.schemas.custom_coltypes.CpickleType,
 'parsetree': doctable.schemas.custom_coltypes.ParseTreeDocFileType,
 'picklefile': doctable.schemas.custom_coltypes.PickleFileType,
 'textfile': doctable.schemas.custom_coltypes.TextFileType}
</code></pre>
<p>Finally, <code>Col</code> allows you to pass keyword arguments directly to the sqlalchemy <code>Column</code> constructor. This includes flags like <code>primary_key</code> or <code>default</code>, which are both used to construct the database schema but do not affect the python dataclass. Note that I recreated the classic <code>id</code> column below.</p>
<pre><code class="language-python">@doctable.schema
class Record:
    __slots__ = []
    id: int = doctable.Col(primary_key=True, autoincrement=True)
    age: int = doctable.Col(nullable=False)
    name: str = doctable.Col(default='MISSING_NAME')

# the schema that would result from this dataclass:
doctable.DocTable(target=':memory:', schema=Record).schema_table()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>type</th>
      <th>nullable</th>
      <th>default</th>
      <th>autoincrement</th>
      <th>primary_key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>INTEGER</td>
      <td>False</td>
      <td>None</td>
      <td>auto</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>age</td>
      <td>INTEGER</td>
      <td>False</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>name</td>
      <td>VARCHAR</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>I also included some shortcut <code>Col</code> functions like <code>IDCol</code>, <code>AddedCol</code>, and <code>UpdatedCol</code> - see below.</p>
<pre><code class="language-python">import datetime

@doctable.schema
class Record:
    __slots__ = []
    id: int = doctable.IDCol() # auto-increment primary key
    added: datetime.datetime = doctable.AddedCol() # record when row was added
    updated: datetime.datetime = doctable.UpdatedCol() # record when row was updated

doctable.DocTable(target=':memory:', schema=Record).schema_table()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>type</th>
      <th>nullable</th>
      <th>default</th>
      <th>autoincrement</th>
      <th>primary_key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>INTEGER</td>
      <td>False</td>
      <td>None</td>
      <td>auto</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>added</td>
      <td>DATETIME</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>updated</td>
      <td>DATETIME</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>In this way, <code>Col</code> allows you to give fine-grained control to both the schema class behavior and the sql schema definition.</p>
<h1 id="working-with-schema-objects">Working With Schema Objects</h1>
<p>Using <code>Col</code> default parameters also has some additional side effects, primarily due to the inherited class <code>DocTableSchema</code>. Among other things, the <code>Col</code> method defines the default dataclass value to be a <code>doctable.EmptyValue()</code> object, which is essentially a placeholder for data that was not inserted into the class upon construction. The <code>__repr__</code> defined in <code>DocTableSchema</code> dictates that member objects containing this value not appear when printing the class, and furthermore, member variables with the value <code>EmptyValue()</code> will not be provided in the database insertion. This means that the database schema is allowed to use its own default value - an effect which is most obviously useful when inserting an object that does not have an <code>id</code> or other automatically provided values.</p>
<p>The example below shows the <code>new_record.id</code> contains <code>EmptyValue()</code> as a default, and that the <code>id</code> column is not included in the insert query - only <code>name</code>.</p>
<pre><code class="language-python">@doctable.schema
class Record:
    __slots__ = []
    id: int = doctable.IDCol()
    name: str = doctable.Col()

new_record = Record(name='Devin Cornell')
print(new_record)
try:
    print(new_record.id)
except doctable.DataNotAvailableError:
    print(f'exception was raised')

table = doctable.DocTable(target=':memory:', schema=Record, verbose=True)
table.insert(new_record)
table.head()
</code></pre>
<pre><code>Record(name='Devin Cornell')
exception was raised
DocTable: INSERT OR FAIL INTO _documents_ (name) VALUES (?)
DocTable: SELECT _documents_.id, _documents_.name 
FROM _documents_
 LIMIT ? OFFSET ?
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Devin Cornell</td>
    </tr>
  </tbody>
</table>
</div>

<p>Yet when we go to retrieve the inserted data, we can see that the value has been replaced by the defaulted value in the database. This is a useful feature if your pipeline involves the insertion of schema objects directly (as opposed to inserting dictionaries for each row).</p>
<pre><code class="language-python">table.select_first(verbose=False)
</code></pre>
<pre><code>Record(id=1, name='Devin Cornell')
</code></pre>
<p>The <code>EmptyValue()</code> feature is also useful when issuing select queries involving only a subset of columns. See here we run a select query where we just retrieve the name data, yet the result is still stored in a <code>Record</code> object.</p>
<pre><code class="language-python">returned_record = table.select_first(['name'], verbose=False)
print(returned_record)
</code></pre>
<pre><code>Record(name='Devin Cornell')
</code></pre>
<p>To avoid working with <code>EmptyValue()</code> objects directly, it is recommended that you use the <code>__getitem__</code> string subscripting to access column data. When using this subscript, the schema object will raise an exception if the returned value is an <code>EmptyValue()</code>.</p>
<pre><code class="language-python">try:
    returned_record.id
except doctable.DataNotAvailableError as e:
    print(e)
</code></pre>
<pre><code>The "id" property is not available. This might happen if you did not retrieve the information from a database or if you did not provide a value in the class constructor.
</code></pre>
<h1 id="indices-and-constraints">Indices and Constraints</h1>
<p>Indices and constraints are provided to the <code>DocTable</code> constructor or definition, as it is not part of the schema class. Here I create custom schema and table definitions where the table has some defined indices and constraints. <code>doctable.Index</code> is really just a direct reference to <code>sqlalchemy.Index</code>, and <code>doctable.Constraint</code> is a mapping to an sqlalchemy constraint type, with the first argument indicating which one.</p>
<pre><code class="language-python">@doctable.schema
class Record:
    __slots__ = []
    id: int = doctable.IDCol()
    name: str = doctable.Col()
    age: int = doctable.Col()

class RecordTable(doctable.DocTable):
    _tabname_ = 'records'
    _schema_ = Record

    # table indices
    _indices_ = (
        doctable.Index('name_index', 'name'),
        doctable.Index('name_age_index', 'name', 'age', unique=True),
    )

    # table constraints
    _constraints_ = (
        doctable.Constraint('unique', 'name', 'age', name='name_age_constraint'),
        doctable.Constraint('check', 'age &gt; 0', name='check_age'),
    )

table = RecordTable(target=':memory:')
</code></pre>
<p>And we can see that the constraints are working when we try to insert a record where age is less than 1.</p>
<pre><code class="language-python">try:
    table.insert(Record(age=-1))
except sqlalchemy.exc.IntegrityError as e:
    print(e)
</code></pre>
<pre><code>(sqlite3.IntegrityError) CHECK constraint failed: check_age
[SQL: INSERT OR FAIL INTO records (age) VALUES (?)]
[parameters: (-1,)]
(Background on this error at: http://sqlalche.me/e/13/gkpj)
</code></pre>
<p>This is a full list of the mappings between constraint names and the associated sqlalchemy objects.</p>
<pre><code class="language-python">doctable.constraint_lookup
</code></pre>
<pre><code>{'check': sqlalchemy.sql.schema.CheckConstraint,
 'unique': sqlalchemy.sql.schema.UniqueConstraint,
 'primarykey': sqlalchemy.sql.schema.PrimaryKeyConstraint,
 'foreignkey': sqlalchemy.sql.schema.ForeignKeyConstraint}
</code></pre>
<h1 id="conclusions">Conclusions</h1>
<p>In this guide, I tried to show some exmaples and give explanations for the ways that schema classes can be used to create doctables. The design is fairly efficent and flexible, and brings a more object-focused approach compared to raw sql queries without the overhead of ORM.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
