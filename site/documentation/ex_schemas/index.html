<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Table Schemas - My Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../ex_basics/" class="dropdown-item">Basics of doctable</a>
</li>
                                    
<li>
    <a href="../ex_insert_delete/" class="dropdown-item">Insert and Delete Queries with doctable</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Table Schemas</a>
</li>
                                    
<li>
    <a href="../ex_select/" class="dropdown-item">Select Queries with doctable</a>
</li>
                                    
<li>
    <a href="../iris_example/" class="dropdown-item">Iris example</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Legacy documentation <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../legacy_documentation/dataclass_example/" class="dropdown-item">Dataclass Schema Example</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/dataclass_vignette_advanced/" class="dropdown-item">Advanced dataclass schema vignette</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/depric_vignette_newsgroups/" class="dropdown-item">NewsGroups Dataset Vignette</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/distributed_basics/" class="dropdown-item">Distribute Parallel Processing Basics</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_basics/" class="dropdown-item">DocTable Overview</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_bootstrap/" class="dropdown-item">Document Bootstrapping Examples</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_concurrency/" class="dropdown-item">Concurrent Database Connections</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_connectengine/" class="dropdown-item">Manage SQL Connections with DocTable</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_file_column_types/" class="dropdown-item">DocTable File Column Types</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_insert_delete/" class="dropdown-item">DocTable Examples: Insert and Delete</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_multitable/" class="dropdown-item">Example: Multiple Tables</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_parsetreedoc_column/" class="dropdown-item">ParseTreeDoc Column Types</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_picklefile/" class="dropdown-item">DocTable Example: Pickle and Text Files</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_schema/" class="dropdown-item">DocTable Schemas</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_schema_dataclass/" class="dropdown-item">DocTable Example: Schemas</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_schema_legacy/" class="dropdown-item">DocTable Schemas</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_select/" class="dropdown-item">DocTable Examples: Select</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/doctable_update/" class="dropdown-item">DocTable Examples: Update</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/example_nss_1_intro/" class="dropdown-item">Vignette 1: Storing Document Metadata</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/example_nss_2_parsing/" class="dropdown-item">Vignette 2: Storing Document Text</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/example_nss_3_parsetrees/" class="dropdown-item">Vignette 3: Storing Parsed Documents</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/example_nss_intro_dataclass/" class="dropdown-item">Example 1: US National Security Strategy Document Corpus</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/legacy_adv/" class="dropdown-item">DocTable (slightly more) Advanced Example</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/legacy_simple/" class="dropdown-item">DocTable Simple Example</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/parse_parsepipeline/" class="dropdown-item">ParsePipeline Basics</a>
</li>
                                    
<li>
    <a href="../../legacy_documentation/parse_parsetrees/" class="dropdown-item">Working with doctable Parsetrees</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../ex_insert_delete/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../ex_select/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#table-schemas" class="nav-link">Table Schemas</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#multi-table-schemas" class="nav-link">Multi-table Schemas</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="table-schemas">Table Schemas</h1>
<p>In this document, I give some examples for defining single and multi-table database schemas in Python. </p>
<pre><code class="language-python">import sys
sys.path.append('../')
import doctable
import pprint
</code></pre>
<h3 id="containers-and-the-table_schema-decorator">Containers and the <code>table_schema</code> decorator</h3>
<p>The first step in using doctable is to define a <em>container</em> object. Container objects are defined using the <code>table_schema</code> decorator, and are used both to define the schema of a database table and to wrap the data for insertion and selection. Container objects act very similar to normal dataclasses - in fact, they actually are dataclasses with additional information needed to create the database table attached. This informaiton is collected at the time when the decorator is used, and thus the decorator serves only to parse the database schema from the class definition, attach that information to the container class, and return the container type as a dataclass.</p>
<pre><code class="language-python">@doctable.table_schema # equivalent to @doctable.table_schema()
class Container1:
    name: str

ins = doctable.inspect_schema(Container1)
print(ins.table_name())
ins.column_info_df()
</code></pre>
<pre><code>Container1
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col Name</th>
      <th>Col Type</th>
      <th>Attr Name</th>
      <th>Hint</th>
      <th>Order</th>
      <th>Primary Key</th>
      <th>Foreign Key</th>
      <th>Index</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>name</td>
      <td>String</td>
      <td>name</td>
      <td>str</td>
      <td>(inf, 0)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">@doctable.table_schema(table_name='container2')
class Container2:
    name: str
    age: int
ins = doctable.inspect_schema(Container2)
print(ins.table_name())
ins.column_info_df()
</code></pre>
<pre><code>container2
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col Name</th>
      <th>Col Type</th>
      <th>Attr Name</th>
      <th>Hint</th>
      <th>Order</th>
      <th>Primary Key</th>
      <th>Foreign Key</th>
      <th>Index</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>name</td>
      <td>String</td>
      <td>name</td>
      <td>str</td>
      <td>(inf, 0)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>age</td>
      <td>Integer</td>
      <td>age</td>
      <td>int</td>
      <td>(inf, 1)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="specifying-column-properties">Specifying Column Properties</h3>
<p>There are two sets of parameters you may adjust to change the behavior of a column: </p>
<ul>
<li>
<p><code>ColumnArgs</code>: adjust the behavior of the generated column. This does not affect the container object, but does affect the database column.</p>
</li>
<li>
<p><code>FieldArgs</code>: adjust the behavior of container attribute by passing arguments to <code>dataclasses.field()</code>. This does not affect the database column, but does affect the way the container object can be used.</p>
</li>
</ul>
<p>Both are passed directly to the <code>Column</code> function, which, as you can see, simply returns a <code>dataclasses.field</code> object with column arguments passed to the <code>metadata</code> attribute. Note that by default, the <code>default</code> argument is set to <code>doctable.MISSING</code>, so the parameter is optional and will be populated with that value. Missing values will be ignored when inserting the object into the database.</p>
<pre><code class="language-python">doctable.Column(
    column_args=doctable.ColumnArgs(),
    field_args=doctable.FieldArgs(),
)
</code></pre>
<pre><code>Field(name=None,type=None,default=MISSING,default_factory=&lt;dataclasses._MISSING_TYPE object at 0x7fc0f9afe590&gt;,init=True,repr=True,hash=None,compare=True,metadata=mappingproxy({'_column_args': ColumnArgs(order=inf, column_name=None, type_kwargs={}, use_type=None, sqlalchemy_type=None, autoincrement=False, nullable=True, unique=None, primary_key=False, index=None, foreign_key=None, default=None, onupdate=None, server_default=None, server_onupdate=None, comment=None, other_kwargs={})}),kw_only=&lt;dataclasses._MISSING_TYPE object at 0x7fc0f9afe590&gt;,_field_type=None)
</code></pre>
<pre><code class="language-python">import datetime

class PhoneNumber(str):
    pass

class Address(str):
    pass

@doctable.table_schema(table_name='container3')
class Container3:
    name: str
    age: int = doctable.Column(field_args=doctable.FieldArgs(init_required=True))
    address: Address = doctable.Column()
    phone: PhoneNumber = doctable.Column()

    # this column will appear first in the database, even though this attribute is later
    _id: int = doctable.Column(
        column_args=doctable.ColumnArgs(
            column_name='id', # name of the column in the db (might not want to have an attr called 'id')
            order = 0, # affects the ordering of the columns in the db
            primary_key=True,
            autoincrement=True,
        ),
    )

    # doctable will define default and onupdate when inserting into database
    added: datetime.datetime = doctable.Column(
        column_args=doctable.ColumnArgs(
            default=datetime.datetime.now, 
            onupdate=datetime.datetime.now
        ),
        field_args = doctable.FieldArgs(
            repr=False, # don't show this field when printing
        )
    )    

doctable.inspect_schema(Container3).column_info_df()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col Name</th>
      <th>Col Type</th>
      <th>Attr Name</th>
      <th>Hint</th>
      <th>Order</th>
      <th>Primary Key</th>
      <th>Foreign Key</th>
      <th>Index</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>Integer</td>
      <td>_id</td>
      <td>int</td>
      <td>(0, 4)</td>
      <td>True</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>name</td>
      <td>String</td>
      <td>name</td>
      <td>str</td>
      <td>(inf, 0)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>age</td>
      <td>Integer</td>
      <td>age</td>
      <td>int</td>
      <td>(inf, 1)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>address</td>
      <td>String</td>
      <td>address</td>
      <td>Address</td>
      <td>(inf, 2)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>phone</td>
      <td>String</td>
      <td>phone</td>
      <td>PhoneNumber</td>
      <td>(inf, 3)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>added</td>
      <td>DateTime</td>
      <td>added</td>
      <td>datetime</td>
      <td>(inf, 5)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>now</td>
    </tr>
  </tbody>
</table>
</div>

<p>Notice that the string representation does not show the <code>added</code> attribute, as specified via <code>FieldAargs(repr=False)</code>.</p>
<pre><code class="language-python">Container3('Devin J. Cornell', 30)
</code></pre>
<pre><code>Container3(name='Devin J. Cornell', age=30, address=MISSING, phone=MISSING, _id=MISSING)
</code></pre>
<h3 id="indices">Indices</h3>
<p>Indices may be added to a table by passing a dictionary of name, <code>Index</code> pairs to the <code>indices</code> parameter of the <code>table_schema</code> decorator. The arguments are the columns, and any additional keyword arguments may be passed after.</p>
<pre><code class="language-python">@doctable.table_schema(
    table_name='container4',
    indices = {
        'ind_name': doctable.Index('name'),
        'ind_name_age': doctable.Index('name', 'age', unique=True),
    }
)
class Container4:
    name: str
    age: int

ins = doctable.inspect_schema(Container4)
ins.index_info_df()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>columns</th>
      <th>kwargs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ind_name</td>
      <td>name</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>ind_name_age</td>
      <td>name, age</td>
      <td>unique: True</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="constraints">Constraints</h3>
<p>You may pass constraints through the <code>constraint</code> parameter of the <code>table_schema</code> decorator.</p>
<p>There are several types of constraints you may want to use in your schema. The following methods are thin wrappers over the <a href="https://docs.sqlalchemy.org/en/20/core/constraints.html">SQLAlchemy objects of the same name</a>.</p>
<table>
<thead>
<tr>
<th>docs</th>
<th>Constraint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.sqlalchemy.org/en/20/core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint">link</a></td>
<td><code>ForeignKey(local_columns, foreign_columns, optional[onupdate], optional[ondelete])</code></td>
<td>A foreign key constraint.</td>
</tr>
<tr>
<td><a href="https://docs.sqlalchemy.org/en/20/core/constraints.html#sqlalchemy.schema.CheckConstraint">link</a></td>
<td><code>CheckConstraint(text, optional[Name])</code></td>
<td>A unique constraint.</td>
</tr>
<tr>
<td><a href="https://docs.sqlalchemy.org/en/20/core/constraints.html#sqlalchemy.schema.UniqueConstraint">link</a></td>
<td><code>UniqueConstraint(*column_names, optional[name])</code></td>
<td>A unique constraint.</td>
</tr>
<tr>
<td><a href="https://docs.sqlalchemy.org/en/20/core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint">link</a></td>
<td><code>PrimaryKeyConstraint(*column_names, optional[name])</code></td>
<td>A unique constraint.</td>
</tr>
</tbody>
</table>
<pre><code class="language-python">@doctable.table_schema(
    table_name='container5',
    constraints = [
        #doctable.ForeignKey(..), # see multi-table schemas below
        doctable.CheckConstraint('age &gt;= 0', name='check_age'),
        doctable.UniqueConstraint('age', 'name', name='unique_age_name'),
        doctable.PrimaryKeyConstraint('id'),
    ]
)
class Container5:
    id: int # this is the primary key now
    name: str
    age: int
</code></pre>
<h3 id="column-types">Column Types</h3>
<p>The column type resolution works according to the following steps:</p>
<ol>
<li>Check <code>ColumnArgs.sqlalchemy_type</code> and use this if it is not <code>None</code>.</li>
<li>Check if column is foreign key - if it is, ask sqlalchemy to resolve the type</li>
<li>Check <code>ColumnArgs.use_type</code> and use this if it is provided.</li>
<li>Use the provided type hint to resolve the type.</li>
</ol>
<p>The valid type hints and their sqlalchemy equivalents are listed below.</p>
<table>
<thead>
<tr>
<th>Type Hint</th>
<th>SQLAlchemy Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>int</code></td>
<td><code>sqlalchemy.Integer</code></td>
</tr>
<tr>
<td><code>float</code></td>
<td><code>sqlalchemy.Float</code></td>
</tr>
<tr>
<td><code>bool</code></td>
<td><code>sqlalchemy.Boolean</code></td>
</tr>
<tr>
<td><code>str</code></td>
<td><code>sqlalchemy.String</code></td>
</tr>
<tr>
<td><code>bytes</code></td>
<td><code>sqlalchemy.LargeBinary</code></td>
</tr>
<tr>
<td><code>datetime.datetime</code></td>
<td><code>sqlalchemy.DateTime</code></td>
</tr>
<tr>
<td><code>datetime.time</code></td>
<td><code>sqlalchemy.Time</code></td>
</tr>
<tr>
<td><code>datetime.date</code></td>
<td><code>sqlalchemy.Date</code></td>
</tr>
<tr>
<td><code>typing.Any</code></td>
<td><code>sqlalchemy.PickleType</code></td>
</tr>
<tr>
<td><code>'datetime.datetime'</code></td>
<td><code>sqlalchemy.DateTime</code></td>
</tr>
<tr>
<td><code>'datetime.time'</code></td>
<td><code>sqlalchemy.Time</code></td>
</tr>
<tr>
<td><code>'datetime.date'</code></td>
<td><code>sqlalchemy.Date</code></td>
</tr>
<tr>
<td><code>'Any'</code></td>
<td><code>sqlalchemy.PickleType</code></td>
</tr>
</tbody>
</table>
<p>You can get the mappings programatically if needed as well:</p>
<pre><code class="language-python">doctable.type_mappings()
</code></pre>
<pre><code>{int: sqlalchemy.sql.sqltypes.Integer,
 float: sqlalchemy.sql.sqltypes.Float,
 bool: sqlalchemy.sql.sqltypes.Boolean,
 str: sqlalchemy.sql.sqltypes.String,
 bytes: sqlalchemy.sql.sqltypes.LargeBinary,
 datetime.datetime: sqlalchemy.sql.sqltypes.DateTime,
 datetime.time: sqlalchemy.sql.sqltypes.Time,
 datetime.date: sqlalchemy.sql.sqltypes.Date,
 doctable.schema.column.column_types.PickleType: sqlalchemy.sql.sqltypes.PickleType,
 'datetime.datetime': sqlalchemy.sql.sqltypes.DateTime,
 'datetime.time': sqlalchemy.sql.sqltypes.Time,
 'datetime.date': sqlalchemy.sql.sqltypes.Date,
 doctable.schema.column.column_types.JSON: sqlalchemy.sql.sqltypes.JSON}
</code></pre>
<h4 id="special-column-types">Special Column Types</h4>
<p>There are several special column types that can be used in your schemas.</p>
<table>
<thead>
<tr>
<th>Type Hint</th>
<th>SQLAlchemy Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>doctable.JSON</code></td>
<td><code>sqlalchemy.JSON</code></td>
<td>Calls <code>json.dumps</code> on write, <code>json.loads</code> on read.</td>
</tr>
<tr>
<td><code>doctable.PickleType</code></td>
<td><code>sqlalchemy.PickleType</code></td>
<td>Calls <code>pickle.dumps</code> on write, <code>pickle.loads</code> on read.</td>
</tr>
</tbody>
</table>
<pre><code class="language-python">import dataclasses
import typing

@dataclasses.dataclass
class Address:
    street: str
    city: str
    state: str
    zip: str

@doctable.table_schema
class Container6:
    name: str

    # NOTE: will be serialized as a JSON string in the database
    # notice how we can use a more accurate type hint and still specify
    # the column type using use_type
    other_info: typing.Dict[str, typing.Union[str,int,float]] = doctable.Column(
        column_args=doctable.ColumnArgs(
            use_type=doctable.JSON,
        ),
        field_args=doctable.FieldArgs(default_factory=dict),
    )

    # NOTE: will be pickled in the database
    address: Address = doctable.Column(
        column_args=doctable.ColumnArgs(
            use_type=doctable.PickleType,
        )
    )

doctable.inspect_schema(Container6).column_info_df()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col Name</th>
      <th>Col Type</th>
      <th>Attr Name</th>
      <th>Hint</th>
      <th>Order</th>
      <th>Primary Key</th>
      <th>Foreign Key</th>
      <th>Index</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>name</td>
      <td>String</td>
      <td>name</td>
      <td>str</td>
      <td>(inf, 0)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>other_info</td>
      <td>JSON</td>
      <td>other_info</td>
      <td>Dict</td>
      <td>(inf, 1)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>address</td>
      <td>PickleType</td>
      <td>address</td>
      <td>Address</td>
      <td>(inf, 2)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now create a new container object that contains an address for insertion.</p>
<pre><code class="language-python">new_obj = Container6(
    name = 'Devin J. Cornell', 
    other_info = {'favorite_color': 'blue'},
    address = Address('123 Main St.', 'San Francisco', 'CA', '94122'), 
)
new_obj
</code></pre>
<pre><code>Container6(name='Devin J. Cornell', other_info={'favorite_color': 'blue'}, address=Address(street='123 Main St.', city='San Francisco', state='CA', zip='94122'))
</code></pre>
<p>Now we open a new database, insert the row, and query it back - you can see that the dict data was converted to json and back again, and the address was converted to pickle data and back again.</p>
<pre><code class="language-python">core = doctable.ConnectCore.open(':memory:', 'sqlite')
with core.begin_ddl() as ddl:
    tab = ddl.create_table(Container6)

with tab.query() as q:
    q.insert_single(new_obj)

with core.query() as q:
    result = q.select(tab.all_cols())
result.first()
</code></pre>
<pre><code>('Devin J. Cornell', {'favorite_color': 'blue'}, Address(street='123 Main St.', city='San Francisco', state='CA', zip='94122'))
</code></pre>
<h2 id="multi-table-schemas">Multi-table Schemas</h2>
<p>The example below shows two linked tables: one for colors, and the other for people. Each person has a favorite color that is constrained by a foriegn key to the colors table. The colors table also has a unique constraint on the color name. I demonstrate use of the <code>Column</code> function to describe behavior of columns - specifically the use of <code>ColumnArgs</code> to specify additional column features that are not conveyed through type annotations or attribute names. I also show use of the <code>Index</code> object for creating indexes, the <code>UniqueConstraint</code> object for creating unique constraints, and the <code>ForeignKey</code> object for creating foreign key constraints. </p>
<p>Note that the container object representing the database schema is also a usable <code>dataclass</code> that can used like any other container object. In fact, tables created according to this schema can insert these objects directly and will wrap return values issued via select queries.</p>
<pre><code class="language-python">import datetime

@doctable.table_schema(
    table_name='color',
    constraints = [
        doctable.UniqueConstraint('name'),
    ]
)
class Color:
    name: str
    id: int = doctable.Column(
        column_args=doctable.ColumnArgs(
            primary_key=True,
            autoincrement=True,
        )
    )

# lets say we use this instead of an int
class PersonID(int):
    pass

# add table-level parameters to this decorator
@doctable.table_schema(
    table_name='person',
    indices = {
        'ind_name_birthday': doctable.Index('name', 'birthday', unique=True),
    },
    constraints = [ # these constraints are set on the database
        doctable.CheckConstraint('length(address) &gt; 0'), # cannot have a blank address
        doctable.UniqueConstraint('birthday', 'fav_color'),
        doctable.ForeignKey(['fav_color'], ['color.name'], onupdate='CASCADE', ondelete='CASCADE'),
    ],
    frozen = True, # parameter passed to dataclasses.dataclass
)
class Person:
    name: str

    # default value will be &quot;not provided&quot; - good standardization
    address: str = doctable.Column(
        column_args=doctable.ColumnArgs(
            server_default='not provided',
        )
    )

    # provided as datetime, set to be indexed
    birthday: datetime.datetime = doctable.Column(
        column_args=doctable.ColumnArgs(
            index = True,
        )
    )

    # note that this has a foreign key constraint above
    fav_color: str = doctable.Column(
        column_args=doctable.ColumnArgs(
            nullable=False,
        )
    )

    id: PersonID = doctable.Column( # standard id column
        column_args=doctable.ColumnArgs(
            order=0, # will be the first column
            primary_key=True,
            autoincrement=True
        ),
    )

    # doctable will define default and onupdate when inserting into database
    added: datetime.datetime = doctable.Column(
        column_args=doctable.ColumnArgs(
            index=True,
            default=datetime.datetime.utcnow, 
            onupdate=datetime.datetime.utcnow
        )
    )

    # this property will not be stored in the database 
    #   - it acts like any other property
    @property
    def age(self):
        return datetime.datetime.now() - self.birthday


core = doctable.ConnectCore.open(
    target=':memory:', 
    dialect='sqlite'
)
# NOTE: weird error when trying to run this twice after defining containers
with core.begin_ddl() as emitter:
    core.enable_foreign_keys() # NOTE: NEEDED TO ENABLE FOREIGN KEYS
    color_tab = emitter.create_table_if_not_exists(container_type=Color)
    person_tab = emitter.create_table_if_not_exists(container_type=Person)
for col_info in person_tab.inspect_columns():
    print(f'{col_info[&quot;name&quot;]}: {col_info[&quot;type&quot;]}')
</code></pre>
<pre><code>id: INTEGER
name: VARCHAR
address: VARCHAR
birthday: DATETIME
fav_color: VARCHAR
added: DATETIME
</code></pre>
<p>Insertion into the color table is fairly straightforward.</p>
<pre><code class="language-python">color_names = ['red', 'green', 'blue']
colors = [Color(name=name) for name in color_names]
with color_tab.query() as q:
    q.insert_multi(colors)
    for c in q.select():
        print(c)
    #print(q.select())
</code></pre>
<pre><code>Color(name='red', id=1)
Color(name='green', id=2)
Color(name='blue', id=3)
</code></pre>
<p>Insertion into the person table is similar, and note that we see an exception if we try to insert a person with a favorite color that is not in the color table.</p>
<pre><code class="language-python">persons = [
    Person(name='John', birthday=datetime.datetime(1990, 1, 1), fav_color='red'),
    Person(name='Sue', birthday=datetime.datetime(1991, 1, 1), fav_color='green'),
    Person(name='Ren', birthday=datetime.datetime(1995, 1, 1), fav_color='blue'),
]
other_person = Person(
    name='Bob', 
    address='123 Main St', 
    birthday=datetime.datetime(1990, 1, 1), 
    fav_color='other', # NOTE: THIS WILL CAUSE AN ERROR (NOT IN COLOR TABLE)
)

import sqlalchemy.exc

sec_in_one_year = 24*60*60*365
with person_tab.query() as q:
    q.insert_multi(persons, ifnotunique='replace')

    try:
        q.insert_single(other_person, ifnotunique='replace')
        print(f'THIS SHOULD NOT APPEAR')
    except sqlalchemy.exc.IntegrityError as e:
        print(f'successfully threw exception: {e}')

    for p in q.select():
        print(f'{p.name} ({p.fav_color}): {p.age.total_seconds()//sec_in_one_year:0.0f} y/o')
</code></pre>
<pre><code>successfully threw exception: (sqlite3.IntegrityError) FOREIGN KEY constraint failed
[SQL: INSERT OR REPLACE INTO person (name, address, birthday, fav_color, added) VALUES (?, ?, ?, ?, ?)]
[parameters: ('Bob', '123 Main St', '1990-01-01 00:00:00.000000', 'other', '2023-11-14 22:17:40.402308')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
John (red): 33 y/o
Sue (green): 32 y/o
Ren (blue): 28 y/o
</code></pre>
<p>The foreign key works as expected because we set <code>onupdate</code>: changing that value in the parent table will update the value in the child table.</p>
<pre><code class="language-python">with color_tab.query() as q:
    q.update_single(dict(name='reddish'), where=color_tab['name']=='red')
    for c in q.select():
        print(c)

with person_tab.query() as q:
    for p in q.select():
        print(f'{p.name} ({p.fav_color}): {p.age.total_seconds()//sec_in_one_year:0.0f} y/o')
</code></pre>
<pre><code>Color(name='reddish', id=1)
Color(name='green', id=2)
Color(name='blue', id=3)
John (reddish): 33 y/o
Sue (green): 32 y/o
Ren (blue): 28 y/o
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
