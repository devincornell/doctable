
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../doctable_concurrency/">
      
      
        <link rel="next" href="../doctable_file_column_types/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.10">
    
    
      
        <title>Manage SQL Connections with DocTable - doctable Package</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#manage-sql-connections-with-doctable" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="doctable Package" class="md-header__button md-logo" aria-label="doctable Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            doctable Package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Manage SQL Connections with DocTable
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/devincornell/doctable" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    devincornell/doctable
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="doctable Package" class="md-nav__button md-logo" aria-label="doctable Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    doctable Package
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/devincornell/doctable" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    devincornell/doctable
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation and Change Log
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/ex_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics of doctable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/ex_insert_delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert and Delete Queries with doctable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/ex_schemas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Table Schemas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/ex_select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Select Queries with doctable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/iris_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iris example
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Legacy documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Legacy documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dataclass_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dataclass Schema Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dataclass_vignette_advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced dataclass schema vignette
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../depric_vignette_newsgroups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NewsGroups Dataset Vignette
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../distributed_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distribute Parallel Processing Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_bootstrap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Document Bootstrapping Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_concurrency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concurrent Database Connections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Manage SQL Connections with DocTable
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Manage SQL Connections with DocTable
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connectengine-class" class="md-nav__link">
    <span class="md-ellipsis">
      ConnectEngine Class
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConnectEngine Class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Working with tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-and-accessing-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Creating and accessing tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropping-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Dropping tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-connections-with-connectengine" class="md-nav__link">
    <span class="md-ellipsis">
      Managing connections with ConnectEngine
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doctable-and-connectengine" class="md-nav__link">
    <span class="md-ellipsis">
      DocTable and ConnectEngine
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_file_column_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable File Column Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_insert_delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Examples: Insert and Delete
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_multitable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example: Multiple Tables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_parsetreedoc_column/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ParseTreeDoc Column Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_picklefile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Example: Pickle and Text Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Schemas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_schema_dataclass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Example: Schemas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_schema_legacy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Schemas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Examples: Select
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../doctable_update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Examples: Update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../example_nss_1_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vignette 1: Storing Document Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../example_nss_2_parsing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vignette 2: Storing Document Text
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../example_nss_3_parsetrees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vignette 3: Storing Parsed Documents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../example_nss_intro_dataclass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example 1: US National Security Strategy Document Corpus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../legacy_adv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable (slightly more) Advanced Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../legacy_simple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Simple Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../parse_parsepipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ParsePipeline Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../parse_parsetrees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with doctable Parsetrees
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connectengine-class" class="md-nav__link">
    <span class="md-ellipsis">
      ConnectEngine Class
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConnectEngine Class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Working with tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-and-accessing-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Creating and accessing tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropping-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Dropping tables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-connections-with-connectengine" class="md-nav__link">
    <span class="md-ellipsis">
      Managing connections with ConnectEngine
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#doctable-and-connectengine" class="md-nav__link">
    <span class="md-ellipsis">
      DocTable and ConnectEngine
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="manage-sql-connections-with-doctable">Manage SQL Connections with DocTable</h1>
<p>This is meant to give a bit more depth describing how doctable works under-the-hood. I won't cover the details of DocTable methods or working with doctable objects, but I will try to give a clearer sense of how connections and tables are managed within a doctable instance.</p>
<p>The driving motivator behind doctable is to create an object-oriented interface for working with sql tables by linking schemas described in your code with the structure of the databases you work with. This model is less ideal for the kinds of application-based frameworks where you would define the database schema once and build code around it separately, but works well for data science applications where you will be creating new tables and playing with different schemas regularly as your approach and end-goals change.</p>
<p>When you instantiate a DocTable (or inheriting class), the object will convert your provided schema into a set of sqlalchemy objects which are then stored in-memory as part of the doctable instance. If the table does not already exist in the actual database, DocTable can create one that matches the provided schema, and then the schema will be used to work with the underlying database table. I will now discuss the lower-level objects that manage the metadata and connections to the database.</p>
<pre><code class="language-python">import sys
sys.path.append('..')
import doctable
</code></pre>
<h2 id="connectengine-class">ConnectEngine Class</h2>
<p>Each doctable maintains a <code>ConnectEngine</code> object to manage database connections and metadata that make all other database operations possible. I'll demonstrate how to instantiate this class manually to show how it works.</p>
<p>The constructor takes arguments for dialect (sqlite, mysql, etc) and database target (filename or database server) to create new sqlalchemy <a href="https://docs.sqlalchemy.org/en/13/core/engines_connections.html">engine</a> and <a href="https://docs.sqlalchemy.org/en/13/faq/metadata_schema.html">metadata</a> objects. The engine object stores information about the target and can generate database connections, the metadata object stores schemas for registered tables. To work with a table, the metadata object must have the table schema registered, although it can be constructed from the database object itself.</p>
<p>See here that the constructor requires a target (file or server where the database is located) and a dialect (flavor of database engine). This connection sits above individual table connections, and thus maintains no connections of it's own - only the engine that can create connections. We can, however list the tables in the database and perform other operations on the table.</p>
<pre><code class="language-python">engine = doctable.ConnectEngine(target=':memory:', dialect='sqlite')
engine
</code></pre>
<pre><code>sqlite:///:memory:
</code></pre>
<h3 id="working-with-tables">Working with tables</h3>
<p>You can also execute connectionless queries directly from this object, although normally you would create a connection object first and then execute queries from the connection. In this example I use a custom sql query to create a new table.</p>
<p>As the ConnectEngine sits above the level of tables, we can list and drop tables from here.</p>
<pre><code class="language-python"># see there are no tables here yet.
engine.list_tables()
</code></pre>
<pre><code>[]
</code></pre>
<pre><code class="language-python"># run this raw sql query just for example
# NOTE: Normally you would NOT create a table this way using doctable.
# This is just for example purposes.
query = 'CREATE TABLE temp (id INTEGER PRIMARY KEY, number INTEGER NOT NULL)'
engine.execute(query)
</code></pre>
<pre><code>&lt;sqlalchemy.engine.result.ResultProxy at 0x7f62a10e9370&gt;
</code></pre>
<pre><code class="language-python"># see that the table is now in the database
engine.list_tables()
</code></pre>
<pre><code>['temp']
</code></pre>
<pre><code class="language-python"># uses inspect to ask the database directly for the schema
engine.schema('temp')
</code></pre>
<pre><code>[{'name': 'id',
  'type': INTEGER(),
  'nullable': True,
  'default': None,
  'autoincrement': 'auto',
  'primary_key': 1},
 {'name': 'number',
  'type': INTEGER(),
  'nullable': False,
  'default': None,
  'autoincrement': 'auto',
  'primary_key': 0}]
</code></pre>
<pre><code class="language-python"># or as a dataframe
engine.schema_df('temp')
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>type</th>
      <th>nullable</th>
      <th>default</th>
      <th>autoincrement</th>
      <th>primary_key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>INTEGER</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>number</td>
      <td>INTEGER</td>
      <td>False</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>All of these methods I've shown so far access the database tables directly, but currently our python objects do not have any idea of what the table schema looks like. You can view the sqlalchemy table objects actually registered with the engine by using the .tables property. See that it is currently empty! Our python code is not able to work with the table using objects because it does not have record of the schema. Now we'll show how to register tables with the engine.</p>
<h3 id="creating-and-accessing-tables">Creating and accessing tables</h3>
<p>To create a data structure internally representing the database structure, we can either ask sqlalchemy to read the database and create the schema, or we can provide lists of sqlalchemy column objects. Wee that we can access the registered tables using the .tables property.</p>
<pre><code class="language-python"># see that currently our engine does not have information about the table we created above.
engine.tables
</code></pre>
<pre><code>immutabledict({})
</code></pre>
<pre><code class="language-python"># now I ask doctable to read the database schema and register the table in metadata.
engine.add_table('temp')
</code></pre>
<pre><code>Table('temp', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', INTEGER(), table=&lt;temp&gt;, primary_key=True, nullable=False), Column('number', INTEGER(), table=&lt;temp&gt;, nullable=False), schema=None)
</code></pre>
<pre><code class="language-python"># and we can see that the table is registered
engine.tables
</code></pre>
<pre><code>immutabledict({'temp': Table('temp', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', INTEGER(), table=&lt;temp&gt;, primary_key=True, nullable=False), Column('number', INTEGER(), table=&lt;temp&gt;, nullable=False), schema=None)})
</code></pre>
<p>When add_table() is called, a new sqlalchemy.Table object is registered in the engine's metadata and returned. If add_table() is called again, it will return the table already registered in the metadata. Because we usually use doctable to manage tables, we'll just show a short example here.</p>
<pre><code class="language-python"># while we can use doctable to do most of this work 
#  usually, I'll just show how sqlalchemy core objects 
#  can be used to create a table in ConnectEngine.
from sqlalchemy import Column, Integer, String

# create a list of columns
columns = (
    Column('id', Integer, primary_key = True), 
    Column('name', String), 
)

# we similarly use the add_table() method to store the schema
#  in the metadata
engine.add_table('temp2', columns=columns)
</code></pre>
<pre><code>Table('temp2', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', Integer(), table=&lt;temp2&gt;, primary_key=True, nullable=False), Column('name', String(), table=&lt;temp2&gt;), schema=None)
</code></pre>
<pre><code class="language-python"># see now that the engine has information about both tables
engine.tables
</code></pre>
<pre><code>immutabledict({'temp': Table('temp', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', INTEGER(), table=&lt;temp&gt;, primary_key=True, nullable=False), Column('number', INTEGER(), table=&lt;temp&gt;, nullable=False), schema=None), 'temp2': Table('temp2', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', Integer(), table=&lt;temp2&gt;, primary_key=True, nullable=False), Column('name', String(), table=&lt;temp2&gt;), schema=None)})
</code></pre>
<pre><code class="language-python"># and see that you can get individual table object references like this
engine.tables['temp']
</code></pre>
<pre><code>Table('temp', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', INTEGER(), table=&lt;temp&gt;, primary_key=True, nullable=False), Column('number', INTEGER(), table=&lt;temp&gt;, nullable=False), schema=None)
</code></pre>
<h3 id="dropping-tables">Dropping tables</h3>
<p>Dropping tables is simple enough, but remember that the schema stored in the database and the objects in code mirror each other, so it is best to manipulate them at the same time. Use .drop_table instead of issuing CREATE TABLE query to make sure they stay in sync. The method can also be used on tables that are not in the metadata engine.</p>
<pre><code class="language-python"># by providing the argument as a string
engine.drop_table('temp')
</code></pre>
<pre><code class="language-python">engine.list_tables()
</code></pre>
<pre><code>['temp2']
</code></pre>
<p>In cases where an underlying table has been deleted but metadata is retained, the drop_table() method will still work but you may need to call clear_metadata() to flush all metadata and add_all_tables() to re-create the metadata from the actual data.</p>
<pre><code class="language-python"># see this works although the temp3 table is not registered in engine metadata
query = 'CREATE TABLE temp3 (id INTEGER PRIMARY KEY, number INTEGER NOT NULL)'
engine.execute(query)
engine.drop_table('temp3')
</code></pre>
<pre><code class="language-python"># this will delete the underlying table even though the metadata information still exists.
query = 'CREATE TABLE temp4 (id INTEGER PRIMARY KEY, number INTEGER NOT NULL)'
engine.execute(query)
engine.execute(f'DROP TABLE IF EXISTS temp4')
engine.list_tables()
</code></pre>
<pre><code>['temp2']
</code></pre>
<pre><code class="language-python"># see that the table is still registered in the metadata
engine.tables
</code></pre>
<pre><code>immutabledict({'temp': Table('temp', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', INTEGER(), table=&lt;temp&gt;, primary_key=True, nullable=False), Column('number', INTEGER(), table=&lt;temp&gt;, nullable=False), schema=None), 'temp2': Table('temp2', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', Integer(), table=&lt;temp2&gt;, primary_key=True, nullable=False), Column('name', String(), table=&lt;temp2&gt;), schema=None), 'temp3': Table('temp3', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', INTEGER(), table=&lt;temp3&gt;, primary_key=True, nullable=False), Column('number', INTEGER(), table=&lt;temp3&gt;, nullable=False), schema=None)})
</code></pre>
<pre><code class="language-python"># in this case, it might be simplest just to clear all metadata
# and re-build according to exising tables
engine.clear_metadata()
engine.reflect()
engine.tables
</code></pre>
<pre><code>immutabledict({'temp2': Table('temp2', MetaData(bind=Engine(sqlite:///:memory:)), Column('id', INTEGER(), table=&lt;temp2&gt;, primary_key=True, nullable=False), Column('name', VARCHAR(), table=&lt;temp2&gt;), schema=None)})
</code></pre>
<h2 id="managing-connections-with-connectengine">Managing connections with ConnectEngine</h2>
<p>ConnectEngine objects are used to create database connections which are maintained by individual doctable objects. Use the get_connection() function to retreive a new connection object which you can use to execute queries. While garbage collecting the connection objects will close the individual connection, sometimes all connections need to be closed simultaneously. This is especially important because garbage-collecting the ConnectEngine object doesn't mean the connections will be garbage-collected if they have references elsewhere in your code. You can close all connections using the close_connections() method.</p>
<pre><code class="language-python"># make new connection
conn = engine.connect()
conn
</code></pre>
<pre><code>&lt;sqlalchemy.engine.base.Connection at 0x7f62a10301f0&gt;
</code></pre>
<pre><code class="language-python"># see here we just run a select query on the empty table, returning an empty list
list(conn.execute('SELECT * FROM temp2'))
</code></pre>
<pre><code>[]
</code></pre>
<p>An important use-case of this feature is when you have multiple processes accessing the same database. In general, each process should have separate connections to the database, but both the engine and metadata stored with the ConnectEngine can be copied. Here I'll show a basic multiprocessing case using the Distribute class (it works much like multiprocessing.Pool()).</p>
<p>In using the map function we open two processes, and in the thread function we call the close_connections() method to delete existing connections which don't exist in this new memory space.</p>
<pre><code class="language-python">def thread(nums, engine: doctable.ConnectEngine):
    # close connections that were opened in other thread
    #engine.close_connections()
    engine.dispose()

    # create a new connection for this thread
    thread_conn = engine.connect()

numbers = [1,2]
with doctable.Distribute(2) as d:
    d.map(thread, numbers, engine)
</code></pre>
<pre><code class="language-python">engine.list_tables()
</code></pre>
<pre><code>['temp2']
</code></pre>
<h2 id="doctable-and-connectengine">DocTable and ConnectEngine</h2>
<p>Every DocTable object maintains a ConnectEngine to store information about the table they represent, and can be accessed through the engine property. When a target and dialect are provided to doctable, it will automatically initialize a new ConnectEngine and store a new connection object.</p>
<pre><code class="language-python"># create a new doctable and view it's engine
schema = (('idcol', 'id'), ('string', 'name'))
db = doctable.DocTable(target=':memory:', schema=schema)
str(db.engine)
</code></pre>
<pre><code>'&lt;ConnectEngine::sqlite:///:memory:&gt;'
</code></pre>
<p>The DocTable constructor can also accept an engine in place of a target and dialect, and thus share ConnectEngines between multiple DocTable objects. In this case, the doctable constructor will use the provided schema to insert the table information into the engine metadata and create the table if doesn't already exist. It will also generate a new connection object from the ConnectEngine.</p>
<pre><code class="language-python"># a w
engine.clear_metadata()
print(engine.tables.keys())
print(engine.list_tables())
</code></pre>
<pre><code>dict_keys([])
['temp2']
</code></pre>
<pre><code class="language-python"># make a new doctable using the existing engine
schema = (('idcol', 'id'), ('string', 'name'))
db = doctable.DocTable(engine=engine, schema=schema, tabname='tmp5')
db
</code></pre>
<pre><code>&lt;doctable.doctable.DocTable at 0x7f62a1096b20&gt;
</code></pre>
<pre><code class="language-python"># make another doctable using existing engine
schema2 = (('idcol', 'id'), ('string', 'name'))
db2 = doctable.DocTable(engine=engine, schema=schema2, tabname='tmp6')
db2
</code></pre>
<pre><code>&lt;doctable.doctable.DocTable at 0x7f62a0fd4cd0&gt;
</code></pre>
<pre><code class="language-python"># we can see that both tables have been created in the database
engine.list_tables()
</code></pre>
<pre><code>['temp2', 'tmp5', 'tmp6']
</code></pre>
<pre><code class="language-python"># and that both are registered in the metadata
engine.tables.keys()
</code></pre>
<pre><code>dict_keys(['tmp5', 'tmp6'])
</code></pre>
<p>Some ConnectEngine methods are also accessable through the DocTable instances.</p>
<pre><code class="language-python">db.list_tables()
</code></pre>
<pre><code>['temp2', 'tmp5', 'tmp6']
</code></pre>
<pre><code class="language-python">db.schema_table()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>type</th>
      <th>nullable</th>
      <th>default</th>
      <th>autoincrement</th>
      <th>primary_key</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>INTEGER</td>
      <td>False</td>
      <td>None</td>
      <td>auto</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>name</td>
      <td>VARCHAR</td>
      <td>True</td>
      <td>None</td>
      <td>auto</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python"># and this is equivalent to calling the engine method reopen(), which clears 
#  metadata and closes connection pool
db.reopen_engine()
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c14ae12.min.js"></script>
      
    
  </body>
</html>