
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../a-ex_basics/">
      
      
        <link rel="next" href="../c-ex_select/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.10">
    
    
      
        <title>Table Schemas - doctable</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#table-schemas" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="doctable" class="md-header__button md-logo" aria-label="doctable" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            doctable
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Table Schemas
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/devincornell/doctable" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    devincornell/doctable
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="doctable" class="md-nav__button md-logo" aria-label="doctable" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    doctable
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/devincornell/doctable" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    devincornell/doctable
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation and Change Log
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../a-ex_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Table Schemas
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Table Schemas
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#containers-and-the-table_schema-decorator" class="md-nav__link">
    <span class="md-ellipsis">
      Containers and the table_schema decorator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-column-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Specifying Column Properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indices" class="md-nav__link">
    <span class="md-ellipsis">
      Indices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Constraints
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#column-types" class="md-nav__link">
    <span class="md-ellipsis">
      Column Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Column Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#special-column-types" class="md-nav__link">
    <span class="md-ellipsis">
      Special Column Types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-table-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-table Schemas
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../c-ex_select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Select Queries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../d-ex_insert_delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Insert and Delete Queries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../e-iris_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Iris Vignette
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Legacy documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Legacy documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/a-introduction_to_legacy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Legacy doctable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/dataclass_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dataclass Schema Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/dataclass_vignette_advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced dataclass schema vignette
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/depric_vignette_newsgroups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NewsGroups Dataset Vignette
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/distributed_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Distribute Parallel Processing Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_bootstrap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Document Bootstrapping Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_concurrency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concurrent Database Connections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_connectengine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manage SQL Connections with DocTable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_file_column_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable File Column Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_insert_delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Examples: Insert and Delete
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_multitable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example: Multiple Tables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_parsetreedoc_column/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ParseTreeDoc Column Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_picklefile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Example: Pickle and Text Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Schemas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_schema_dataclass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Example: Schemas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_schema_legacy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Schemas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Examples: Select
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/doctable_update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Examples: Update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/example_nss_1_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vignette 1: Storing Document Metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/example_nss_2_parsing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vignette 2: Storing Document Text
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/example_nss_3_parsetrees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vignette 3: Storing Parsed Documents
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/example_nss_intro_dataclass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example 1: US National Security Strategy Document Corpus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/legacy_adv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable (slightly more) Advanced Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/legacy_simple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DocTable Simple Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/parse_parsepipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ParsePipeline Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../legacy_documentation/parse_parsetrees/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working with doctable Parsetrees
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#containers-and-the-table_schema-decorator" class="md-nav__link">
    <span class="md-ellipsis">
      Containers and the table_schema decorator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-column-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Specifying Column Properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#indices" class="md-nav__link">
    <span class="md-ellipsis">
      Indices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Constraints
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#column-types" class="md-nav__link">
    <span class="md-ellipsis">
      Column Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Column Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#special-column-types" class="md-nav__link">
    <span class="md-ellipsis">
      Special Column Types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-table-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-table Schemas
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="table-schemas">Table Schemas</h1>
<p>In this document, I give some examples for defining single and multi-table database schemas in Python. </p>
<pre><code class="language-python">import sys
sys.path.append('../')
import doctable
import pprint
</code></pre>
<h3 id="containers-and-the-table_schema-decorator">Containers and the <code>table_schema</code> decorator</h3>
<p>The first step in using doctable is to define a <em>container</em> object. Container objects are defined using the <code>table_schema</code> decorator, and are used both to define the schema of a database table and to wrap the data for insertion and selection. Container objects act very similar to normal dataclasses - in fact, they actually are dataclasses with additional information needed to create the database table attached. This informaiton is collected at the time when the decorator is used, and thus the decorator serves only to parse the database schema from the class definition, attach that information to the container class, and return the container type as a dataclass.</p>
<pre><code class="language-python">@doctable.table_schema # equivalent to @doctable.table_schema()
class Container1:
    name: str

ins = doctable.inspect_schema(Container1)
print(ins.table_name())
ins.column_info_df()
</code></pre>
<pre><code>Container1
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col Name</th>
      <th>Col Type</th>
      <th>Attr Name</th>
      <th>Hint</th>
      <th>Order</th>
      <th>Primary Key</th>
      <th>Foreign Key</th>
      <th>Index</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>name</td>
      <td>String</td>
      <td>name</td>
      <td>str</td>
      <td>(inf, 0)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">@doctable.table_schema(table_name='container2')
class Container2:
    name: str
    age: int
ins = doctable.inspect_schema(Container2)
print(ins.table_name())
ins.column_info_df()
</code></pre>
<pre><code>container2
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col Name</th>
      <th>Col Type</th>
      <th>Attr Name</th>
      <th>Hint</th>
      <th>Order</th>
      <th>Primary Key</th>
      <th>Foreign Key</th>
      <th>Index</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>name</td>
      <td>String</td>
      <td>name</td>
      <td>str</td>
      <td>(inf, 0)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>age</td>
      <td>Integer</td>
      <td>age</td>
      <td>int</td>
      <td>(inf, 1)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="specifying-column-properties">Specifying Column Properties</h3>
<p>There are two sets of parameters you may adjust to change the behavior of a column: </p>
<ul>
<li>
<p><code>ColumnArgs</code>: adjust the behavior of the generated column. This does not affect the container object, but does affect the database column.</p>
</li>
<li>
<p><code>FieldArgs</code>: adjust the behavior of container attribute by passing arguments to <code>dataclasses.field()</code>. This does not affect the database column, but does affect the way the container object can be used.</p>
</li>
</ul>
<p>Both are passed directly to the <code>Column</code> function, which, as you can see, simply returns a <code>dataclasses.field</code> object with column arguments passed to the <code>metadata</code> attribute. Note that by default, the <code>default</code> argument is set to <code>doctable.MISSING</code>, so the parameter is optional and will be populated with that value. Missing values will be ignored when inserting the object into the database.</p>
<pre><code class="language-python">doctable.Column(
    column_args=doctable.ColumnArgs(),
    field_args=doctable.FieldArgs(),
)
</code></pre>
<pre><code>Field(name=None,type=None,default=MISSING,default_factory=&lt;dataclasses._MISSING_TYPE object at 0x7fc0f9afe590&gt;,init=True,repr=True,hash=None,compare=True,metadata=mappingproxy({'_column_args': ColumnArgs(order=inf, column_name=None, type_kwargs={}, use_type=None, sqlalchemy_type=None, autoincrement=False, nullable=True, unique=None, primary_key=False, index=None, foreign_key=None, default=None, onupdate=None, server_default=None, server_onupdate=None, comment=None, other_kwargs={})}),kw_only=&lt;dataclasses._MISSING_TYPE object at 0x7fc0f9afe590&gt;,_field_type=None)
</code></pre>
<pre><code class="language-python">import datetime

class PhoneNumber(str):
    pass

class Address(str):
    pass

@doctable.table_schema(table_name='container3')
class Container3:
    name: str
    age: int = doctable.Column(field_args=doctable.FieldArgs(init_required=True))
    address: Address = doctable.Column()
    phone: PhoneNumber = doctable.Column()

    # this column will appear first in the database, even though this attribute is later
    _id: int = doctable.Column(
        column_args=doctable.ColumnArgs(
            column_name='id', # name of the column in the db (might not want to have an attr called 'id')
            order = 0, # affects the ordering of the columns in the db
            primary_key=True,
            autoincrement=True,
        ),
    )

    # doctable will define default and onupdate when inserting into database
    added: datetime.datetime = doctable.Column(
        column_args=doctable.ColumnArgs(
            default=datetime.datetime.now, 
            onupdate=datetime.datetime.now
        ),
        field_args = doctable.FieldArgs(
            repr=False, # don't show this field when printing
        )
    )    

doctable.inspect_schema(Container3).column_info_df()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col Name</th>
      <th>Col Type</th>
      <th>Attr Name</th>
      <th>Hint</th>
      <th>Order</th>
      <th>Primary Key</th>
      <th>Foreign Key</th>
      <th>Index</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>Integer</td>
      <td>_id</td>
      <td>int</td>
      <td>(0, 4)</td>
      <td>True</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>name</td>
      <td>String</td>
      <td>name</td>
      <td>str</td>
      <td>(inf, 0)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>age</td>
      <td>Integer</td>
      <td>age</td>
      <td>int</td>
      <td>(inf, 1)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>address</td>
      <td>String</td>
      <td>address</td>
      <td>Address</td>
      <td>(inf, 2)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>phone</td>
      <td>String</td>
      <td>phone</td>
      <td>PhoneNumber</td>
      <td>(inf, 3)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>added</td>
      <td>DateTime</td>
      <td>added</td>
      <td>datetime</td>
      <td>(inf, 5)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>now</td>
    </tr>
  </tbody>
</table>
</div>

<p>Notice that the string representation does not show the <code>added</code> attribute, as specified via <code>FieldAargs(repr=False)</code>.</p>
<pre><code class="language-python">Container3('Devin J. Cornell', 30)
</code></pre>
<pre><code>Container3(name='Devin J. Cornell', age=30, address=MISSING, phone=MISSING, _id=MISSING)
</code></pre>
<h3 id="indices">Indices</h3>
<p>Indices may be added to a table by passing a dictionary of name, <code>Index</code> pairs to the <code>indices</code> parameter of the <code>table_schema</code> decorator. The arguments are the columns, and any additional keyword arguments may be passed after.</p>
<pre><code class="language-python">@doctable.table_schema(
    table_name='container4',
    indices = {
        'ind_name': doctable.Index('name'),
        'ind_name_age': doctable.Index('name', 'age', unique=True),
    }
)
class Container4:
    name: str
    age: int

ins = doctable.inspect_schema(Container4)
ins.index_info_df()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>columns</th>
      <th>kwargs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ind_name</td>
      <td>name</td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>ind_name_age</td>
      <td>name, age</td>
      <td>unique: True</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="constraints">Constraints</h3>
<p>You may pass constraints through the <code>constraint</code> parameter of the <code>table_schema</code> decorator.</p>
<p>There are several types of constraints you may want to use in your schema. The following methods are thin wrappers over the <a href="https://docs.sqlalchemy.org/en/20/core/constraints.html">SQLAlchemy objects of the same name</a>.</p>
<table>
<thead>
<tr>
<th>docs</th>
<th>Constraint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.sqlalchemy.org/en/20/core/constraints.html#sqlalchemy.schema.ForeignKeyConstraint">link</a></td>
<td><code>ForeignKey(local_columns, foreign_columns, optional[onupdate], optional[ondelete])</code></td>
<td>A foreign key constraint.</td>
</tr>
<tr>
<td><a href="https://docs.sqlalchemy.org/en/20/core/constraints.html#sqlalchemy.schema.CheckConstraint">link</a></td>
<td><code>CheckConstraint(text, optional[Name])</code></td>
<td>A unique constraint.</td>
</tr>
<tr>
<td><a href="https://docs.sqlalchemy.org/en/20/core/constraints.html#sqlalchemy.schema.UniqueConstraint">link</a></td>
<td><code>UniqueConstraint(*column_names, optional[name])</code></td>
<td>A unique constraint.</td>
</tr>
<tr>
<td><a href="https://docs.sqlalchemy.org/en/20/core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint">link</a></td>
<td><code>PrimaryKeyConstraint(*column_names, optional[name])</code></td>
<td>A unique constraint.</td>
</tr>
</tbody>
</table>
<pre><code class="language-python">@doctable.table_schema(
    table_name='container5',
    constraints = [
        #doctable.ForeignKey(..), # see multi-table schemas below
        doctable.CheckConstraint('age &gt;= 0', name='check_age'),
        doctable.UniqueConstraint('age', 'name', name='unique_age_name'),
        doctable.PrimaryKeyConstraint('id'),
    ]
)
class Container5:
    id: int # this is the primary key now
    name: str
    age: int
</code></pre>
<h3 id="column-types">Column Types</h3>
<p>The column type resolution works according to the following steps:</p>
<ol>
<li>Check <code>ColumnArgs.sqlalchemy_type</code> and use this if it is not <code>None</code>.</li>
<li>Check if column is foreign key - if it is, ask sqlalchemy to resolve the type</li>
<li>Check <code>ColumnArgs.use_type</code> and use this if it is provided.</li>
<li>Use the provided type hint to resolve the type.</li>
</ol>
<p>The valid type hints and their sqlalchemy equivalents are listed below.</p>
<table>
<thead>
<tr>
<th>Type Hint</th>
<th>SQLAlchemy Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>int</code></td>
<td><code>sqlalchemy.Integer</code></td>
</tr>
<tr>
<td><code>float</code></td>
<td><code>sqlalchemy.Float</code></td>
</tr>
<tr>
<td><code>bool</code></td>
<td><code>sqlalchemy.Boolean</code></td>
</tr>
<tr>
<td><code>str</code></td>
<td><code>sqlalchemy.String</code></td>
</tr>
<tr>
<td><code>bytes</code></td>
<td><code>sqlalchemy.LargeBinary</code></td>
</tr>
<tr>
<td><code>datetime.datetime</code></td>
<td><code>sqlalchemy.DateTime</code></td>
</tr>
<tr>
<td><code>datetime.time</code></td>
<td><code>sqlalchemy.Time</code></td>
</tr>
<tr>
<td><code>datetime.date</code></td>
<td><code>sqlalchemy.Date</code></td>
</tr>
<tr>
<td><code>typing.Any</code></td>
<td><code>sqlalchemy.PickleType</code></td>
</tr>
<tr>
<td><code>'datetime.datetime'</code></td>
<td><code>sqlalchemy.DateTime</code></td>
</tr>
<tr>
<td><code>'datetime.time'</code></td>
<td><code>sqlalchemy.Time</code></td>
</tr>
<tr>
<td><code>'datetime.date'</code></td>
<td><code>sqlalchemy.Date</code></td>
</tr>
<tr>
<td><code>'Any'</code></td>
<td><code>sqlalchemy.PickleType</code></td>
</tr>
</tbody>
</table>
<p>You can get the mappings programatically if needed as well:</p>
<pre><code class="language-python">doctable.type_mappings()
</code></pre>
<pre><code>{int: sqlalchemy.sql.sqltypes.Integer,
 float: sqlalchemy.sql.sqltypes.Float,
 bool: sqlalchemy.sql.sqltypes.Boolean,
 str: sqlalchemy.sql.sqltypes.String,
 bytes: sqlalchemy.sql.sqltypes.LargeBinary,
 datetime.datetime: sqlalchemy.sql.sqltypes.DateTime,
 datetime.time: sqlalchemy.sql.sqltypes.Time,
 datetime.date: sqlalchemy.sql.sqltypes.Date,
 doctable.schema.column.column_types.PickleType: sqlalchemy.sql.sqltypes.PickleType,
 'datetime.datetime': sqlalchemy.sql.sqltypes.DateTime,
 'datetime.time': sqlalchemy.sql.sqltypes.Time,
 'datetime.date': sqlalchemy.sql.sqltypes.Date,
 doctable.schema.column.column_types.JSON: sqlalchemy.sql.sqltypes.JSON}
</code></pre>
<h4 id="special-column-types">Special Column Types</h4>
<p>There are several special column types that can be used in your schemas.</p>
<table>
<thead>
<tr>
<th>Type Hint</th>
<th>SQLAlchemy Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>doctable.JSON</code></td>
<td><code>sqlalchemy.JSON</code></td>
<td>Calls <code>json.dumps</code> on write, <code>json.loads</code> on read.</td>
</tr>
<tr>
<td><code>doctable.PickleType</code></td>
<td><code>sqlalchemy.PickleType</code></td>
<td>Calls <code>pickle.dumps</code> on write, <code>pickle.loads</code> on read.</td>
</tr>
</tbody>
</table>
<pre><code class="language-python">import dataclasses
import typing

@dataclasses.dataclass
class Address:
    street: str
    city: str
    state: str
    zip: str

@doctable.table_schema
class Container6:
    name: str

    # NOTE: will be serialized as a JSON string in the database
    # notice how we can use a more accurate type hint and still specify
    # the column type using use_type
    other_info: typing.Dict[str, typing.Union[str,int,float]] = doctable.Column(
        column_args=doctable.ColumnArgs(
            use_type=doctable.JSON,
        ),
        field_args=doctable.FieldArgs(default_factory=dict),
    )

    # NOTE: will be pickled in the database
    address: Address = doctable.Column(
        column_args=doctable.ColumnArgs(
            use_type=doctable.PickleType,
        )
    )

doctable.inspect_schema(Container6).column_info_df()
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Col Name</th>
      <th>Col Type</th>
      <th>Attr Name</th>
      <th>Hint</th>
      <th>Order</th>
      <th>Primary Key</th>
      <th>Foreign Key</th>
      <th>Index</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>name</td>
      <td>String</td>
      <td>name</td>
      <td>str</td>
      <td>(inf, 0)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>other_info</td>
      <td>JSON</td>
      <td>other_info</td>
      <td>Dict</td>
      <td>(inf, 1)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>address</td>
      <td>PickleType</td>
      <td>address</td>
      <td>Address</td>
      <td>(inf, 2)</td>
      <td>False</td>
      <td>False</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now create a new container object that contains an address for insertion.</p>
<pre><code class="language-python">new_obj = Container6(
    name = 'Devin J. Cornell', 
    other_info = {'favorite_color': 'blue'},
    address = Address('123 Main St.', 'San Francisco', 'CA', '94122'), 
)
new_obj
</code></pre>
<pre><code>Container6(name='Devin J. Cornell', other_info={'favorite_color': 'blue'}, address=Address(street='123 Main St.', city='San Francisco', state='CA', zip='94122'))
</code></pre>
<p>Now we open a new database, insert the row, and query it back - you can see that the dict data was converted to json and back again, and the address was converted to pickle data and back again.</p>
<pre><code class="language-python">core = doctable.ConnectCore.open(':memory:', 'sqlite')
with core.begin_ddl() as ddl:
    tab = ddl.create_table(Container6)

with tab.query() as q:
    q.insert_single(new_obj)

with core.query() as q:
    result = q.select(tab.all_cols())
result.first()
</code></pre>
<pre><code>('Devin J. Cornell', {'favorite_color': 'blue'}, Address(street='123 Main St.', city='San Francisco', state='CA', zip='94122'))
</code></pre>
<h2 id="multi-table-schemas">Multi-table Schemas</h2>
<p>The example below shows two linked tables: one for colors, and the other for people. Each person has a favorite color that is constrained by a foriegn key to the colors table. The colors table also has a unique constraint on the color name. I demonstrate use of the <code>Column</code> function to describe behavior of columns - specifically the use of <code>ColumnArgs</code> to specify additional column features that are not conveyed through type annotations or attribute names. I also show use of the <code>Index</code> object for creating indexes, the <code>UniqueConstraint</code> object for creating unique constraints, and the <code>ForeignKey</code> object for creating foreign key constraints. </p>
<p>Note that the container object representing the database schema is also a usable <code>dataclass</code> that can used like any other container object. In fact, tables created according to this schema can insert these objects directly and will wrap return values issued via select queries.</p>
<pre><code class="language-python">import datetime

@doctable.table_schema(
    table_name='color',
    constraints = [
        doctable.UniqueConstraint('name'),
    ]
)
class Color:
    name: str
    id: int = doctable.Column(
        column_args=doctable.ColumnArgs(
            primary_key=True,
            autoincrement=True,
        )
    )

# lets say we use this instead of an int
class PersonID(int):
    pass

# add table-level parameters to this decorator
@doctable.table_schema(
    table_name='person',
    indices = {
        'ind_name_birthday': doctable.Index('name', 'birthday', unique=True),
    },
    constraints = [ # these constraints are set on the database
        doctable.CheckConstraint('length(address) &gt; 0'), # cannot have a blank address
        doctable.UniqueConstraint('birthday', 'fav_color'),
        doctable.ForeignKey(['fav_color'], ['color.name'], onupdate='CASCADE', ondelete='CASCADE'),
    ],
    frozen = True, # parameter passed to dataclasses.dataclass
)
class Person:
    name: str

    # default value will be &quot;not provided&quot; - good standardization
    address: str = doctable.Column(
        column_args=doctable.ColumnArgs(
            server_default='not provided',
        )
    )

    # provided as datetime, set to be indexed
    birthday: datetime.datetime = doctable.Column(
        column_args=doctable.ColumnArgs(
            index = True,
        )
    )

    # note that this has a foreign key constraint above
    fav_color: str = doctable.Column(
        column_args=doctable.ColumnArgs(
            nullable=False,
        )
    )

    id: PersonID = doctable.Column( # standard id column
        column_args=doctable.ColumnArgs(
            order=0, # will be the first column
            primary_key=True,
            autoincrement=True
        ),
    )

    # doctable will define default and onupdate when inserting into database
    added: datetime.datetime = doctable.Column(
        column_args=doctable.ColumnArgs(
            index=True,
            default=datetime.datetime.utcnow, 
            onupdate=datetime.datetime.utcnow
        )
    )

    # this property will not be stored in the database 
    #   - it acts like any other property
    @property
    def age(self):
        return datetime.datetime.now() - self.birthday


core = doctable.ConnectCore.open(
    target=':memory:', 
    dialect='sqlite'
)
# NOTE: weird error when trying to run this twice after defining containers
with core.begin_ddl() as emitter:
    core.enable_foreign_keys() # NOTE: NEEDED TO ENABLE FOREIGN KEYS
    color_tab = emitter.create_table_if_not_exists(container_type=Color)
    person_tab = emitter.create_table_if_not_exists(container_type=Person)
for col_info in person_tab.inspect_columns():
    print(f'{col_info[&quot;name&quot;]}: {col_info[&quot;type&quot;]}')
</code></pre>
<pre><code>id: INTEGER
name: VARCHAR
address: VARCHAR
birthday: DATETIME
fav_color: VARCHAR
added: DATETIME
</code></pre>
<p>Insertion into the color table is fairly straightforward.</p>
<pre><code class="language-python">color_names = ['red', 'green', 'blue']
colors = [Color(name=name) for name in color_names]
with color_tab.query() as q:
    q.insert_multi(colors)
    for c in q.select():
        print(c)
    #print(q.select())
</code></pre>
<pre><code>Color(name='red', id=1)
Color(name='green', id=2)
Color(name='blue', id=3)
</code></pre>
<p>Insertion into the person table is similar, and note that we see an exception if we try to insert a person with a favorite color that is not in the color table.</p>
<pre><code class="language-python">persons = [
    Person(name='John', birthday=datetime.datetime(1990, 1, 1), fav_color='red'),
    Person(name='Sue', birthday=datetime.datetime(1991, 1, 1), fav_color='green'),
    Person(name='Ren', birthday=datetime.datetime(1995, 1, 1), fav_color='blue'),
]
other_person = Person(
    name='Bob', 
    address='123 Main St', 
    birthday=datetime.datetime(1990, 1, 1), 
    fav_color='other', # NOTE: THIS WILL CAUSE AN ERROR (NOT IN COLOR TABLE)
)

import sqlalchemy.exc

sec_in_one_year = 24*60*60*365
with person_tab.query() as q:
    q.insert_multi(persons, ifnotunique='replace')

    try:
        q.insert_single(other_person, ifnotunique='replace')
        print(f'THIS SHOULD NOT APPEAR')
    except sqlalchemy.exc.IntegrityError as e:
        print(f'successfully threw exception: {e}')

    for p in q.select():
        print(f'{p.name} ({p.fav_color}): {p.age.total_seconds()//sec_in_one_year:0.0f} y/o')
</code></pre>
<pre><code>successfully threw exception: (sqlite3.IntegrityError) FOREIGN KEY constraint failed
[SQL: INSERT OR REPLACE INTO person (name, address, birthday, fav_color, added) VALUES (?, ?, ?, ?, ?)]
[parameters: ('Bob', '123 Main St', '1990-01-01 00:00:00.000000', 'other', '2023-11-14 22:17:40.402308')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
John (red): 33 y/o
Sue (green): 32 y/o
Ren (blue): 28 y/o
</code></pre>
<p>The foreign key works as expected because we set <code>onupdate</code>: changing that value in the parent table will update the value in the child table.</p>
<pre><code class="language-python">with color_tab.query() as q:
    q.update_single(dict(name='reddish'), where=color_tab['name']=='red')
    for c in q.select():
        print(c)

with person_tab.query() as q:
    for p in q.select():
        print(f'{p.name} ({p.fav_color}): {p.age.total_seconds()//sec_in_one_year:0.0f} y/o')
</code></pre>
<pre><code>Color(name='reddish', id=1)
Color(name='green', id=2)
Color(name='blue', id=3)
John (reddish): 33 y/o
Sue (green): 32 y/o
Ren (blue): 28 y/o
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c14ae12.min.js"></script>
      
    
  </body>
</html>